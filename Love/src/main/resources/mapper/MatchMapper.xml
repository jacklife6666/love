<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.love.datingapp.mapper.MatchMapper">
    <insert id="save">
        INSERT INTO t_matches (user1_id, user2_id)
        VALUES (#{user1Id}, #{user2Id})
    </insert>
    <select id="findMatchesByUserId" resultType="com.love.datingapp.common.dto.MatchVO">
        SELECT
            m.id AS matchId,
            p.user_id AS matchedUserId,
            p.nickname,
            p.avatar
        FROM
            t_matches m
                JOIN
            t_user_profile p ON (p.user_id = m.user1_id OR p.user_id = m.user2_id)
        WHERE
            (m.user1_id = #{userId} OR m.user2_id = #{userId})
          AND p.user_id != #{userId}
    </select>
</mapper>